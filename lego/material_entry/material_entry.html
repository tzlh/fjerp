<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv = "Content-Type" content = "text/html; charset=utf-8">
    <meta http-equiv = "X-UA-Compatible" content = "IE=edge">
    <meta name = "viewport" content = "width=device-width, initial-scale=1">
    <link rel = "stylesheet" href = "../../plugin/bootstrap/3.3.7/css/bootstrap.css"/>
    <link rel = "stylesheet" href = "../../plugin/jquery_ui/1.12.1/jquery-ui.min.css">
    <link rel = "stylesheet" href = "../../plugin/jquery_timepicker_addon/1.6.3/jquery-ui-timepicker-addon.css" />
    <link rel = "stylesheet" href = "material_entry.css"/>
    <link rel = "stylesheet" href = "../../css/custom_modal.css"/>
    <script src = "../../plugin/jquery/1.12.4/jquery.min.js" type = "text/javascript" charset = "utf-8"></script>
    <script src = "../../plugin/bootstrap/3.3.7/js/bootstrap.js" type = "text/javascript" charset = "utf-8"></script>
    <script src = "../../plugin/jquery_ui/1.12.1/jquery-ui.min.js"></script>
    <script src = "../../plugin/jquery_timepicker_addon/1.6.3/jquery-ui-timepicker-addon.min.js"></script>  
    <script src = "../../plugin/jquery_timepicker_addon/1.6.3/init.js"></script>
    <script src = "../../js/configure.js" type = "text/javascript" charset = "utf-8"></script>
    <script src = "../../js/toolkit.js" type = "text/javascript" charset = "utf-8"></script>
    <script src = "../check_login/check_login.js"></script>
    <script src = "material_entry.js" type = "text/javascript" charset = "utf-8"></script>
	</head>
  <script>
    $(document).ready(function() {
      //生成对象
      let materialEntryArea = new materialEntry("#material_entry_content");
      materialEntryArea.output();
      materialEntryArea.clearRawData();
      // 获取公式
      materialEntryArea.getFormula();
      // 公式赋值
      materialEntryArea.fillFormulaData();
      $(document).on("change", ".cfName", function() {
        let entryValue = $(this).parents("td").siblings(".entryValue").find("input").val();
        if ("" == entryValue) {
          alert("请输入此入库值");
          $(this).val("");
          return;
        } else {
          if(null == entryValue.match(/^(\d+)(\.\d+)?$/)) {
            alert("此入库值格式不正确");
            $(this).val("");
            return;
          }
        }
        let content = $(this).val();
        $(this).parents("td").siblings(".cfContent").find("input").val(content);
        //计算结果值
        let cfContent = materialEntryArea.replaceCfContent(content);
        console.log(cfContent);
        try {
          let result = eval(cfContent);
          console.log(result);
        $(this).parents("td").siblings(".endValue").find("input").val(result);
        } catch (e) {
          alert("公式错误");
          $(this).val("");
          $(this).parents("td").siblings(".cfContent").find("input").val("");
          return;
        }
      });
      $(document).on("change", ".E_d_t", function() {
        let content = $(this).val();
        for(var i = 0; i < $(".E_end_d_t option").length; i++){
          if($(".E_end_d_t  option").eq(i).val() == content) {
            $(".E_end_d_t option").eq(i).prop('selected','selected');
            break;
          }
        }
      });
      $(document).on("change", ".E_c_c_3_h_50_t", function() {
        let content = $(this).val();
        for(var i = 0; i < $(".E_end_c_c_3_h_50_t option").length; i++){
          if($(".E_end_c_c_3_h_50_t  option").eq(i).val() == content) {
            $(".E_end_c_c_3_h_50_t option").eq(i).prop('selected','selected');
            break;
          }
        }
      });
      materialEntryArea.getWarehouse();
      $(document).on("focus", "#selectWarehousePotId", function() {
        materialEntryArea.getWarehousePot();
        materialEntryArea.fillWarehousePotData();
      });
      $(document).on("change", "#selectWarehouseId", function() {
        $("selectWarehousePotId").val("");
        materialEntryArea.getWarehousePot();
        materialEntryArea.fillWarehousePotData(); 
      });
      $(document).on("click", "#searchBtn", function() {
        $("materialCategoryId").val("");
        materialEntryArea.getMaterialCategory();
        materialEntryArea.fillMaterialCategoryData();
        materialEntryArea.getWarehousePotMaterialIndex()
        materialEntryArea.fillVariableData();
      });
      materialEntryArea.fillWarehouseData();
      $(document).on("click", "#addMaterialEntryBtn button", function() {
        materialEntryArea.getMaterialCategoryByUuid();
        materialEntryArea.addWarehousePotMaterialIndex();   
        materialEntryArea.modifyWarehousePotMaterialType();
      });
      $(document).on("click", "#modifyMaterialEntryBtn button", function() {
        materialEntryArea.getMaterialCategoryByUuid();
        materialEntryArea.modifyMaterialIndex();   
        materialEntryArea.modifyWarehousePotMaterialType();
      });
    })
  </script>
	<body>
    <div class = "row" id = "material_entry_content"></div>
	</body>
</html>
